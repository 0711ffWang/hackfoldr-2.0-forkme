<!DOCTYPE html><html><head><meta charset="utf-8"><!-- libraries--><script type="text/javascript" src="/assets/jquery/1.10.2/jquery.min.js"></script><link rel="stylesheet" type="text/css" href="/assets/semantic-ui/0.19.0/css/semantic.min.css"><script type="text/javascript" src="/assets/semantic-ui/0.19.0/javascript/semantic.min.js"></script><!-- custom files--><script type="text/javascript" src="/js/global.js"></script><script type="text/javascript" src="/js/csv.js"></script><script type="text/javascript" src="/js/handlebars-v1.3.0.js"></script><link rel="stylesheet" href="/css/global.css"><title> | hackfoldr</title></head><body><nav id="sidebar"><nav id="nav"><div class="ui menu collapsed mode hidden"><a class="item expand button"><i class="icon arrow right"></i></a></div><div class="ui menu expanded mode"><div class="ui dropdown item shortcuts"><i class="icon home"></i><div class="menu"><a src="http://g0v.tw" class="link item">g0v 官網<i class="icon browser"></i></a><div class="ui accordion"><div class="title item">各期黑客松<i class="icon dropdown"></i></div><div class="content"><a href="/g0v-hackath9n" class="item">還我土地 2014-06-21<i class="icon exchange"></i></a><a href="/g0v-hackath8n" class="item">解除戒嚴 2014-04-19<i class="icon exchange"></i></a><a href="/g0v-hackath7n" class="item">自由時代 2014-02-22<i class="icon exchange"></i></a><a href="/g0v-hackath6n" class="item">勞動基準 2013-12-21<i class="icon exchange"></i></a><a href="/g0v-hackath5n" class="item">美麗島 2013-10-20<i class="icon exchange"></i></a><a href="/g0v-hackath4n" class="item">國民大會 2013-08-10<i class="icon exchange"></i></a><a href="/g0v-hackath3n" class="item">客廳工廠 2013-06-06<i class="icon exchange"></i></a><a href="/g0v-hackath2n" class="item">九大建設 2013-03-23<i class="icon exchange"></i></a><a href="/g0v-hackath1n" class="item">公地放領 2013-01-27<i class="icon exchange"></i></a><a href="/g0v-hackath0n" class="item">動員戡亂 2012-12-01<i class="icon exchange"></i></a></div></div></div></div><div class="ui dropdown item history"><i class="icon time"></i><div class="menu"></div></div><div class="ui dropdown item about"><i class="icon help"></i><div class="menu"><a src="https://g0v.hackpad.com/welcome_to_hackfoldr#Welcome-to-Hackfoldr" class="link item">使用說明<i class="icon text file outline"></i></a><a src="welcome-to-hackfoldr" class="foldr item">開發與回報<i class="icon exchange"></i></a></div></div><a class="right item collapse button"><i class="icon arrow left"></i></a><div class="right icon item zoom ui dropdown"><i class="icon zoom in"></i><div class="menu"><div class="item normal">100%</div><div class="item large">130%</div><div class="item larger">150%</div></div></div></div></nav><nav id="topbar"><div class="ui secondary pointing menu"><div class="item title expanded mode"></div><a class="right item view table"><i class="icon pencil"></i></a><a class="right item refresh table hidden"><i class="icon repeat"></i></a></div></nav><nav id="toc"><div class="ui vertical menu"></div></nav></nav><div id="wrapper"><div class="frame"><iframe id="iframe" name="iframe"></iframe></div></div><div id="script"><script>window.jQuery || document.write('<script src="/js/vendor/jquery-1.10.2.min.js"><\/script>')</script><script type="text/javascript" src="/js/global.js"></script><script>var paths = location.pathname.split('/') || [];
var ethercalc_name     = paths[1] || "welcome-to-hackfoldr";
var current_iframe_url = paths[2] ? unescape(unescape(paths[2])) : null;
var iframe_src;
var history_state={};
//localStorage.setItem("hackfoldr","[]");
var foldr_histories = JSON.parse(localStorage.getItem("hackfoldr")) || [];

$('#toc').on('click','a', function(event){
  iframe_path = event.target.href;
    if( iframe_path.match(/^https:\/\/.*.hackpad.com\//) ){
      iframe_path = iframe_path.split(/\//).pop().split(/-/).pop();
  }
   history.pushState(history_state,'', '/'+ethercalc_name+'/'+encodeURIComponent(encodeURIComponent(iframe_path))) ;
})

$.get('https://ethercalc.org/_/'+ethercalc_name+'/csv').pipe(CSV.parse).done(function(rows){

  var got_title = false
  var depth = 0 // if depth == 1, link should in accordion
  
  var link_tpl_source ='<a href="{{url}}" target="iframe" class="link item"><span class="expanded mode">{{subject}}</span><i class="icon text file outline"></i></a>';
  var link_tpl = Handlebars.compile(link_tpl_source);
  
  var add_link = function(row){
    try{
      var link_options = JSON.parse(row[2]);
    }catch(e){
      var link_options = {};
    }
    var context = {url: row[0].trim(), subject: row[1]};
    var $link_el = $(link_tpl(context));
    for(key in link_options){
      $link_el.attr(key, link_options[key]);
    }
    if(depth == 1){
      $('#toc .ui.accordion:last').find('.menu').append($link_el)
    }else{
      $('#toc .ui.vertical').append($link_el)
    }
    // enable default iframe
    if((new RegExp(context.url+"/?")).test(current_iframe_url)){
      iframe_src = current_iframe_url;
    }else if(/^https:\/\/.*.hackpad.com\//.test(context.url)){
      if( current_iframe_url === context.url.split(/\//).pop().split(/-/).pop()){
        iframe_src = context.url;
      }
    }
    if(!iframe_src) {
      iframe_src = context.url;
    }
  }
  
  var accordion_tpl_source = '<div class="ui accordion"><div class="title header item "><span class="expanded mode">{{title}}</span><i class="icon folder closed"></i><i class="icon folder open hidden" style="display: none;"></i></div><div class="content menu"></div></div>';
  var accordion_tpl = Handlebars.compile(accordion_tpl_source);
  
  var add_accordion = function(row){
    try{
      var options = JSON.parse(row[2]);
    }catch(e){
      var options = {};
    }
    var context = {title: row[1] };
    var $accordion_el = $(accordion_tpl(context));
    
    $accordion_el.appendTo('#toc .ui.vertical').accordion({onChange: function(){
      $accordion_el.find('.folder').toggle()
    }})
    
    if(options.expand){
      $accordion_el.accordion('open',0)
    }
  }
  
  $.each(rows, function(row_index, row){
    // if 1st and 2nd is empty then this a empty row 
    if(row[0].trim().length === 0 && row[1].trim().length === 0){
      return
    }
    
    // now we have soming thing, should get title first
    if(!got_title){
    
      // TODO: need opt....
      $.each(row, function(col_index, col){
        col = col.trim()
        
        // get the MAGIC title 
        if(!got_title && !col.match(/^#/) && col.length > 0) {
          $('#topbar .title').html(col);
          got_title = true;
          
          // add to history menu
          
          var current_foldr_history = {
            foldr_name: col,
            foldr_id: ethercalc_name
          };
          
          // TODO: Remove all items in foldr_histories that share the same foldr_id before unshift
          foldr_histories = $.grep(foldr_histories, function(value){
            return value !== JSON.stringify(current_foldr_history);
          });
          foldr_histories.unshift(JSON.stringify(current_foldr_history));
          localStorage.setItem("hackfoldr", JSON.stringify(foldr_histories));
        }
        
      })
      
    } else {
      if(row[0].length == 0){ // folder 
        depth = 1
        add_accordion(row)
      }else{ // link
        add_link(row)
      }
    }
  });
  $("#iframe").attr("src",iframe_src);
})

// setup history menu
$.each(foldr_histories, function(index, foldr_history){
  var item = JSON.parse(foldr_history);
  $("#nav .history .menu").append(
    $('<a />', { href: '/'+item.foldr_id, 'class': 'foldr item' })
        .text(item.foldr_name)
        .append($('<i class="icon exchange"></i>'))
  );
  });
  
// for semantic ui css specificity
$(".hidden").hide();

// shortcuts menu
$("#nav a.foldr").on("click tap", function(){
  location = "http://hack.etblue.tw/" + $(this).attr("src")
  });
$("#nav a.link").on("click tap", function(){
  $("#iframe").attr("src",$(this).attr("src"));
  });
  
// sidebar expansion buttons
$("#nav .collapse.button").on("click tap", function(){
  $("#sidebar").width("3rem");
  $("#wrapper").css("padding-left","3rem");
  $(".expanded.mode").hide();
  $(".collapsed.mode").show();
  $("#sidebar i.icon").addClass("collapsed");
  });
$("#nav .expand.button").on("click tap", function(){
  $("#sidebar").width("20rem");
  $("#wrapper").css("padding-left","20rem");
  $(".expanded.mode").css("display","");
  $(".collapsed.mode").hide();
  $("#sidebar i.icon").removeClass("collapsed");
  });
  
// firefox fix for iframe initial size
$("#wrapper .frame").addClass("normal size");

// zoom in buttons
$("#nav .zoom.dropdown .normal").on("click tap", function(){
  $(".frame, #iframe").removeClass("large larger").addClass("normal size");
  });
$("#nav .zoom.dropdown .large").on("click tap", function(){
  $(".frame, #iframe").removeClass("normal larger").addClass("large size");
  });
$("#nav .zoom.dropdown .larger").on("click tap", function(){
  $(".frame, #iframe").removeClass("normal large").addClass("larger size");
  });
  
// edit table
$("#topbar .view.table").on("click tap", function(){
  $("#iframe").attr("src","https://ethercalc.org/"+ethercalc_name);
  $("#topbar .table.item").toggle();
  });
$("#topbar .refresh.table").on("click tap", function(){
  location.reload(true);
  });
$("#toc a.link.item, #nav a.link.item").on("click tap", function(){
  $("#topbar .view.table").show();
  $("#topbar .refresh.table").hide();
  });</script></div></body></html>